<!DOCTYPE html>
<html>
<head>
    <title>Debug Fixes</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .debug { padding: 15px; margin: 10px 0; border: 1px solid #ddd; background: white; border-radius: 5px; }
        .success { border-color: #28a745; background: #d4edda; }
        .error { border-color: #dc3545; background: #f8d7da; }
        .info { border-color: #17a2b8; background: #d1ecf1; }
        code { background: #f8f9fa; padding: 2px 4px; border-radius: 3px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>üîç Debug Fixes Status</h1>
    
    <!-- Test Elements (Hidden) -->
    <div style="display: none;">
        <input type="text" id="customer-name" placeholder="M√º≈üteri Adƒ±">
        <div id="customer-search-results"></div>
        <input type="text" id="product-search" placeholder="√úr√ºn Kodu">
        <div id="search-results"></div>
    </div>
    
    <div id="debug1" class="debug">
        <strong>1. orderManager Object Check</strong><br>
        <span id="debug1-result">Checking...</span>
    </div>
    
    <div id="debug2" class="debug">
        <strong>2. Customer Search Elements</strong><br>
        <span id="debug2-result">Checking...</span>
    </div>
    
    <div id="debug3" class="debug">
        <strong>3. Event Listeners Check</strong><br>
        <span id="debug3-result">Checking...</span>
    </div>
    
    <div id="debug4" class="debug">
        <strong>4. Global Functions Check</strong><br>
        <span id="debug4-result">Checking...</span>
    </div>
    
    <div id="debug5" class="debug">
        <strong>5. jsPDF System Check</strong><br>
        <span id="debug5-result">Checking...</span>
    </div>
    
    <!-- Include jsPDF loading system -->
    <script>
        // jsPDF loading system (copied from main page)
        window.jsPDFLoadAttempts = 0;
        window.jsPDFLoadingPromise = null;
        
        function checkJsPDFLoaded() {
            return (typeof window.jsPDF !== 'undefined') || 
                   (typeof window.jspdf !== 'undefined') ||
                   (window.jspdf && window.jspdf.jsPDF);
        }
        
        function getJsPDFConstructor() {
            if (window.jsPDF) return window.jsPDF;
            if (window.jspdf && window.jspdf.jsPDF) return window.jspdf.jsPDF;
            if (typeof jsPDF !== 'undefined') return jsPDF;
            return null;
        }
        
        function loadJsPDF() {
            if (window.jsPDFLoadingPromise) {
                return window.jsPDFLoadingPromise;
            }
            
            window.jsPDFLoadingPromise = new Promise((resolve, reject) => {
                if (checkJsPDFLoaded()) {
                    console.log('jsPDF already loaded successfully');
                    resolve(getJsPDFConstructor());
                    return;
                }
                
                window.jsPDFLoadAttempts++;
                console.log('Attempting to load jsPDF, attempt:', window.jsPDFLoadAttempts);
                
                const cdnUrls = [
                    'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js',
                    'https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js',
                    'https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js'
                ];
                
                function tryLoadScript(index) {
                    if (index >= cdnUrls.length) {
                        console.error('All jsPDF CDNs failed to load');
                        reject(new Error('Failed to load jsPDF from all CDNs'));
                        return;
                    }
                    
                    const script = document.createElement('script');
                    script.src = cdnUrls[index];
                    script.onload = function() {
                        console.log('jsPDF loaded successfully from:', script.src);
                        setTimeout(() => {
                            if (checkJsPDFLoaded()) {
                                resolve(getJsPDFConstructor());
                            } else {
                                tryLoadScript(index + 1);
                            }
                        }, 100);
                    };
                    script.onerror = function() {
                        console.log('Failed to load jsPDF from:', script.src);
                        tryLoadScript(index + 1);
                    };
                    document.head.appendChild(script);
                }
                
                tryLoadScript(0);
            });
            
            return window.jsPDFLoadingPromise;
        }
        
        // Ensure jsPDF is available when needed
        window.ensureJsPDF = function() {
            return loadJsPDF();
        };
        
        // Start loading immediately
        loadJsPDF();
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <script src="js/database.js?v=1.2"></script>
    <script src="js/customerDatabase.js?v=1.2"></script>
    <script src="js/orderManager.js?v=1.2"></script>
    <script src="js/app.js?v=1.2"></script>
    
    <script>
        setTimeout(() => {
            // Debug 1: orderManager Object
            const debug1 = document.getElementById('debug1');
            const debug1Result = document.getElementById('debug1-result');
            
            if (typeof orderManager !== 'undefined') {
                debug1.className = 'debug success';
                debug1Result.innerHTML = `‚úÖ orderManager exists<br>
                    - Type: ${typeof orderManager}<br>
                    - Has selectCustomer: ${typeof orderManager.selectCustomer === 'function'}<br>
                    - Has setupCustomerNameListener: ${typeof orderManager.setupCustomerNameListener === 'function'}`;
            } else {
                debug1.className = 'debug error';
                debug1Result.textContent = '‚ùå orderManager not found';
            }
        }, 1000);
        
        setTimeout(() => {
            // Debug 2: Customer Search Elements
            const debug2 = document.getElementById('debug2');
            const debug2Result = document.getElementById('debug2-result');
            
            const customerInput = document.getElementById('customer-name');
            const customerResults = document.getElementById('customer-search-results');
            
            if (customerInput && customerResults) {
                debug2.className = 'debug success';
                debug2Result.innerHTML = `‚úÖ Customer search elements found<br>
                    - customer-name input: ${customerInput ? 'Found' : 'Missing'}<br>
                    - customer-search-results div: ${customerResults ? 'Found' : 'Missing'}`;
            } else {
                debug2.className = 'debug error';
                debug2Result.innerHTML = `‚ùå Customer search elements missing<br>
                    - customer-name input: ${customerInput ? 'Found' : 'Missing'}<br>
                    - customer-search-results div: ${customerResults ? 'Found' : 'Missing'}`;
            }
        }, 1500);
        
        setTimeout(() => {
            // Debug 3: Event Listeners
            const debug3 = document.getElementById('debug3');
            const debug3Result = document.getElementById('debug3-result');
            
            const customerResults = document.getElementById('customer-search-results');
            
            // Try to detect if event listeners are attached
            const hasListeners = customerResults && getEventListeners && getEventListeners(customerResults).click;
            
            if (hasListeners) {
                debug3.className = 'debug success';
                debug3Result.textContent = '‚úÖ Event listeners detected on customer-search-results';
            } else {
                debug3.className = 'debug info';
                debug3Result.innerHTML = `‚ÑπÔ∏è Event listeners check (cannot be detected in production)<br>
                    - getEventListeners available: ${typeof getEventListeners !== 'undefined'}<br>
                    - This is normal - event delegation should still work`;
            }
        }, 2000);
        
        setTimeout(() => {
            // Debug 4: Global Functions
            const debug4 = document.getElementById('debug4');
            const debug4Result = document.getElementById('debug4-result');
            
            const functions = {
                'window.ensureJsPDF': typeof window.ensureJsPDF,
                'window.loadJsPDF': typeof window.loadJsPDF,
                'window.checkJsPDFLoaded': typeof window.checkJsPDFLoaded
            };
            
            const foundFunctions = Object.entries(functions).filter(([name, type]) => type === 'function');
            
            if (foundFunctions.length > 0) {
                debug4.className = 'debug success';
                debug4Result.innerHTML = `‚úÖ Global functions found:<br>` + 
                    foundFunctions.map(([name, type]) => `- ${name}: ${type}`).join('<br>');
            } else {
                debug4.className = 'debug error';
                debug4Result.innerHTML = `‚ùå No global functions found:<br>` + 
                    Object.entries(functions).map(([name, type]) => `- ${name}: ${type}`).join('<br>');
            }
        }, 2500);
        
        setTimeout(() => {
            // Debug 5: jsPDF System
            const debug5 = document.getElementById('debug5');
            const debug5Result = document.getElementById('debug5-result');
            
            const jsPDFChecks = {
                'window.jsPDF': typeof window.jsPDF,
                'window.jspdf': typeof window.jspdf,
                'global jsPDF': typeof jsPDF !== 'undefined' ? typeof jsPDF : 'undefined'
            };
            
            const foundJsPDF = Object.entries(jsPDFChecks).filter(([name, type]) => type !== 'undefined');
            
            if (foundJsPDF.length > 0) {
                debug5.className = 'debug success';
                debug5Result.innerHTML = `‚úÖ jsPDF found:<br>` + 
                    Object.entries(jsPDFChecks).map(([name, type]) => `- ${name}: ${type}`).join('<br>');
            } else {
                debug5.className = 'debug error';
                debug5Result.innerHTML = `‚ùå jsPDF not loaded:<br>` + 
                    Object.entries(jsPDFChecks).map(([name, type]) => `- ${name}: ${type}`).join('<br>');
            }
        }, 3000);
    </script>
</body>
</html>